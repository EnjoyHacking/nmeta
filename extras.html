<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Nmeta : Extensible Traffic Classification on SDN">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Nmeta</title>
  </head>

  <body>

  <!-- NAVBAR -->
  <div id="header"></div>
  <div class="navbar-box">
    <div id="nav">
        <ul id="navbar">
          <li><a href="index.html">Welcome</a></li>
          <li><a href="motivation.html">Motivation</a></li>
          <li><a href="install.html">Install</a></li>
          <li><a href="develop.html">Develop</a></li>
          <li><a href="faq.html">FAQ</li>
          <li>Extras</a></li>
        </ul>
    </div>
	<div id="navbreak">
	</div>
    <div id="nav2">
      <ul id="navbar2">
        <li><a href="#" class="black">&nbsp;</a></li>
        <li><a href="#" class="black">&nbsp;</a></li>
        <li><a href="#" class="black">&nbsp;</a></li>
        <li><a href="#" class="black">&nbsp;</a></li>
        <li><a href="misc.html">Misc Scripts</a></li>
        <li>Build a Lab</li>
      </ul>
    </div>
    <div id="navbreak">
	</div>
  </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<h1>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Build a Lab
</h1>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Contents:
</h3>
<p>
  <a href="#Pre-Requisites">Pre-Requisites</a>
  <br>
  <a href="#base-ubuntu-vm-build">Base Ubuntu VM Build</a>
  <br>
  <a href="#vm1">VM1 Server / Controller</a>
  <br>
  <a href="#vm2">VM2 Central Open vSwitch</a>
  <br>
  <a href="#vm3">VM3 WAN Simulation</a>
</p>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Introduction
</h3>

<p>Want to experiment with nmeta and OpenFlow SDN, but don't have any switches? No problem. You can build a simple, but powerful, lab within a virtualised environment. These instructions should hopefully save you a lot of time figuring out the more obtuse features. Oracle VirtualBox is used as the hypervisor. Here is a logical diagram of the environment</p>

<p><img src="images/lab/lab_overview.png" alt="Lab Overview"></p>

<h2>
  <a id="Pre-Requisites" class="anchor" href="#Pre-Requisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Pre-Requisites
</h2>

<p>
  <ul>
    <li>Oracle VirtualBox installed on a suitable host machine</li>
    <li>Host must have sufficient RAM (test PC was Windows 7 with 8GB RAM)</li>
  </ul>
</p>

<h2>
  <a id="base-ubuntu-vm-build" class="anchor" href="#base-ubuntu-vm-build" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Base Ubuntu VM Build
</h2>
<p>Here we build a base Ubuntu VM image which we can clone to make most of the other guests.</p>

<p>First, download a suitable supported Ubuntu desktop distribution. In VirtualBox, create a new Ubuntu guest with 1024MB of RAM and 12GB of storage. Consider creating the hard disk as fixed size to improve performance.</p>

<p><img src="images/lab/lab1.png" alt="Lab Pic 1"></p>
<p><img src="images/lab/lab2.png" alt="Lab Pic 2"></p>
<p><img src="images/lab/lab6.png" alt="Lab Pic 6"></p>

<p>Go into the guest settings to configure it to boot off the ISO. Under Storage, click on the Controller: IDE row and then click on the Add CD/DVD Device Icon, "Choose disk" and browse to the ISO:</p>

<p><img src="images/lab/lab7.png" alt="Lab Pic 7"></p>
<p><img src="images/lab/lab8.png" alt="Lab Pic 8"></p>

<p>Do the same process to add the ISO for the Guest Additions. On Windows it is located in C:\Program Files\Oracle\VirtualBox\VBoxGuestAdditions.iso</p>

<p><img src="images/lab/lab9.png" alt="Lab Pic 9"></p>

<p>As above, there should now be two ISO files associated.</p>

<p>Start the VM and install Ubuntu as per the defaults (or your own preferences!)</p>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Install VirtualBox Additions
</h3>

<p>Once the build is completed and the guest is running, log in and start a terminal window (CTRL+ALT+T). Install the VirtualBox additions for improved host-guest integration:</p>

<pre><code>cd /media
</code></pre>

<p>Look for the appropriate subdirectories that contain the correct additions version. Example:</p>

<p><img src="images/lab/lab11.png" alt="Lab Pic 11"></p>

<p>Run the additions:</p>

<pre><code>sudo ./VBoxLinuxAdditions.run
</code></pre>

<p>Restart the guest to bring the additions online. You may also want to change the copy/paste settings in VirtualBox to allow pasting to the guest:</p>

<p><img src="images/lab/lab12.png" alt="Lab Pic 12"></p>

<p>&nbsp;</p>

<h2>
  <a id="vm1" class="anchor" href="#vm1" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  VM1 Server / Controller
</h2>

<p>This will be the central server that runs the Ryu SDN controller and nmeta.</p>
<p>Start by making a clone of the base Ubuntu VM and call it something suitable.</p>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Configure Networking
</h3>
<p>Go into the Network settings and leave Adapter 1 as per defaults to allow NAT access to the Internet (required for downloading software packages from the Internet). Configure Adapter 2 as per screenshot below to connect to Internal Network "WAN-1":</p>

<p><img src="images/lab/lab10.png" alt="Lab Pic 10"></p>

<p>Edit /etc/network/interfaces:</p>

<pre><code>sudo vi /etc/network/interfaces
</code></pre>

<p>Add the following:</p>

<pre><code>auto eth1
iface eth1 inet static
address 192.168.57.40
netmask 255.255.255.0
#
up route add -net 192.168.56.0/24 gw 192.168.57.1 dev eth1
</code></pre>

<p>Restart networking:</p>

<pre><code>sudo /etc/init.d/networking restart
</code></pre>

<p>Now, install Ryu, nmeta etc as per instructions on the <a href="install.html">Installation Page</a></p>

<p>&nbsp;</p>

<h2>
  <a id="vm2" class="anchor" href="#vm2" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  VM2 Central Open vSwitch
</h2>

<p>This will be the central Open vSwitch that connects the server to the WAN simulator.</p>
<p>Start by making a clone of the base Ubuntu VM and call it something suitable.</p>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Configure Guest Network Adapters
</h3>
<p>Go into the Network settings and leave Adapter 1 as per defaults to allow NAT access to the Internet (required for downloading software packages from the Internet). Configure Adapter 2 and 3 as per screenshots below, noting that promiscuous mode MUST be changed to "Allow VMs". This mode is required to allow the guest to function as a switch.</p>

<p><img src="images/lab/lab14.png" alt="Lab Pic 14"></p>

<p><img src="images/lab/lab15.png" alt="Lab Pic 15"></p>

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Install Open vSwitch
</h3>

<p>Install openvswitch-common and openvswitch-switch (both in same package):</p>

<pre><code>sudo apt-get install openvswitch-switch
</code></pre>

<p>Check that it is running:</p>
<pre><code>sudo ovs-vsctl show
</code></pre>

<p>Set up bridge 'br0':</p>
<pre><code>sudo ovs-vsctl add-br br0
</code></pre>

<p>Add physical interfaces:</p>
<pre><code>sudo ovs-vsctl add-port br0 eth1
sudo ovs-vsctl add-port br0 eth2
</code></pre>

<p>Edit /etc/network/interfaces:</p>

<pre><code>sudo vi /etc/network/interfaces
</code></pre>

<p>Add the following:</p>

<pre><code>auto br0
iface br0 inet static
address 192.168.57.3
network 192.168.57.0
netmask 255.255.255.0
broadcast 192.168.57.255
gateway 192.168.57.1
#
up route add -net 192.168.56.0/24 gw 192.168.57.1 dev br0
</code></pre>

<p>Now, do a full restart of the guest.

<h3>
  <a id="general-configuration" class="anchor" href="#general-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  Configure Open vSwitch
</h3>

<p>Check connectivity to the OpenFlow controller:</p>

<pre><code>ping 192.168.57.40
</code></pre>

<p>On <strong>VM1</strong>, start Ryu OpenFlow Controller:</p>

<pre><code>cd ryu
PYTHONPATH=. ./bin/ryu-manager --verbose ryu/app/simple_switch.py
</code></pre>

<p>On <strong>VM2</strong>, set Open vSwitch to contact Controller:</p>

<pre><code>sudo ovs-vsctl set-controller br0 tcp:192.168.57.40:6633
</code></pre>

<p>Check Open vSwitch connectivity to OpenFlow Controller:</p>

<pre><code>sudo ovs-vsctl show
</code></pre>

<p>Here is output showing successful connection with the controller:</p>

<p>*** Under Construction!!! ***</p>

<h2>
  <a id="vm3" class="anchor" href="#vm3" aria-hidden="true"><span class="octicon octicon-link"></span></a>
  VM3 WAN Simulation
</h2>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Nmeta maintained by <a href="https://github.com/mattjhayes" target="_blank">mattjhayes</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
